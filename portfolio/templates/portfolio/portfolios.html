{% extends 'home/base.html' %}
{% load static %}

{% block head %}
    {{ block.super }}
    <style>
        body {
            background-color: black;
            color: white;
        }

        .container {
            padding-top: 20px;
        }

        .frosted {
            backdrop-filter: blur(5px);
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-update, .btn-primary {
            background-color: #C0C0C0; /* Matte silver background */
            color: black; /* Black text */
            border: none;
            cursor: pointer;
            padding:10px;
            margin-left: 10px;
            margin-top:8px;
            border-radius: 8px; /* Space from the input field */
        }

        .btn-update:hover, .btn-primary:hover {
            background-color: #A9A9A9; /* Darker shade for hover */
        }

        .btn-primary {
            padding: 0.375rem 0.75rem; /* Bootstrap's default padding for buttons */
        }

        .tooltip-container {
            display: inline-block;
            position: relative;
            cursor: pointer;
        }

        .tooltip-text {
            visibility: hidden;
            width: 220px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 100%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="frosted">
        <h2>Welcome, Update Your Profile</h2>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-info">{{ message }}</div>
            {% endfor %}
        {% endif %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.non_field_errors }}

            <div class="mb-3">
                <label for="id_portfolio_url">Portfolio URL</label>
                <input type="url" name="portfolio_url" id="id_portfolio_url" value="{{ content_creator.portfolio_url }}" class="form-control" readonly>
                <button type="button" onclick="unlockField('id_portfolio_url')" class="btn-update">Update</button>
            </div>

            <div class="mb-3">
                <label for="id_expertise_area">Expertise Area</label>
                <input type="text" name="expertise_area" id="id_expertise_area" value="{{ content_creator.expertise_area }}" class="form-control" readonly>
                <button type="button" onclick="unlockField('id_expertise_area')" class="btn-update">Update</button>
            </div>

            <div class="mb-3">
                <label>Social Media Links</label>
                {% for url_name, url in content_creator.social_media_links.items %}
                    <div class="input-group mb-2">
                        <input type="text" name="social_media_{{ url_name }}" value="{{ url }}" class="form-control" placeholder="{{ url_name|capfirst }} URL" readonly>
                        <div class="input-group-append">
                            <button class="btn btn-danger" type="button" onclick="removeField(this)">Remove</button>
                        </div>
                    </div>
                {% endfor %}
                <div id="social-media-fields"></div>
                <button type="button" class="btn btn-secondary" onclick="addField()">Add Link</button>
            </div>

            <div class="mb-3">
                <label for="id_profile_photo">Profile Photo</label>
                {% if content_creator.profile_photo %}
                    <img src="{{ content_creator.profile_photo.url }}" alt="Profile photo" class="mb-2"/>
                {% endif %}
                <input type="file" name="profile_photo" id="id_profile_photo" class="form-control" readonly>
                <button type="button" onclick="unlockField('id_profile_photo')" class="btn-update">Update</button>
                <small class="form-text text-light">
                    Max size 0.3 MB.
                </small>
                <div class="tooltip-container">
                    <i class="fas fa-info-circle"></i>
                    <span class="tooltip-text">Use free online services like TinyPNG or ImageResize to reduce image sizes before uploading.</span>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Update Profile</button>
        </form>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.9.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- FontAwesome for icons -->
<link href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" rel="stylesheet">
<script>

   function unlockField(fieldId) {
        var field = document.getElementById(fieldId);
        field.readOnly = false;
        if(field.type === 'file') {
            // Clear the file input for new file, since we can't make file input readonly
            field.value = "";
        }
    }
    function addField() {
        const container = document.getElementById('social-media-fields');
        const fieldHTML = `
            <div class="input-group mb-2">
                <input type="text" name="social_media_links[]" class="form-control" placeholder="Social Media URL">
                <div class="input-group-append">
                    <button class="btn btn-danger" type="button" onclick="removeField(this)">Remove</button>
                </div>
            </div>`;
        container.insertAdjacentHTML('beforeend', fieldHTML);
    }

    function removeField(btn) {
        const fieldGroup = btn.closest('.input-group');
        fieldGroup.remove();
    }

    // Initialize tooltips
    $(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });
    function removeField(btn) {
    const fieldGroup = btn.closest('.input-group');
    fieldGroup.remove();
}

function addField() {
    const container = document.getElementById('social-media-fields');
    const fieldHTML = `
        <div class="input-group mb-2">
            <input type="text" name="new_social_media_links[]" class="form-control" placeholder="Social Media URL">
            <div class="input-group-append">
                <button class="btn btn-danger" type="button" onclick="removeField(this)">Remove</button>
            </div>
        </div>`;
    container.insertAdjacentHTML('beforeend', fieldHTML);
}

function removeField(btn) {
    const fieldGroup = btn.closest('.input-group');
    fieldGroup.remove();
}
function saveSocialMediaLinks() {
    // Collect all social media links from the form
    const socialMediaLinks = {};
    const socialMediaInputs = document.querySelectorAll('[name^="social_media_"]');
    
    socialMediaInputs.forEach(input => {
        const name = input.name.split('_')[2]; // Extract the social media platform name
        const url = input.value;
        socialMediaLinks[name] = url;
    });

    // Collect newly added links
    const newSocialMediaInputs = document.querySelectorAll('[name="new_social_media_links[]"]');
    
    newSocialMediaInputs.forEach(input => {
        const url = input.value;
        // Add these links to the socialMediaLinks object as well
        socialMediaLinks['new'] = url;
    });

    // Convert the object to a JSON string
    const socialMediaJSON = JSON.stringify(socialMediaLinks);

    // Create a hidden input field to store the JSON data
    const hiddenInput = document.createElement('input');
    hiddenInput.type = 'hidden';
    hiddenInput.name = 'social_media_links';
    hiddenInput.value = socialMediaJSON;

    // Append the hidden input to the form
    const form = document.querySelector('form');
    form.appendChild(hiddenInput);

    // Log the social media links data for debugging
    console.log(socialMediaJSON);

    // Submit the form to save the data
    form.submit();
}

// Initialize tooltips
$(function () {
    $('[data-toggle="tooltip"]').tooltip();
});
</script>

{% endblock %}